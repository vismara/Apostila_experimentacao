---
title: "üìñ Fator Quantitativo e Regress√£o Polinomial"
---

*M√≥dulo 2 ‚Äì Semana 10*

## üå± Cen√°rio aplicado

No viveiro, queremos definir **dose de nitrog√™nio** para maximizar o **crescimento inicial** de mudas. Em outro ensaio, avaliamos como o **pH do substrato** (ap√≥s calagem) afeta o **di√¢metro do colo**. Em ambos os casos o fator √© **quantitativo** e o objetivo √© **modelar a resposta em fun√ß√£o do n√≠vel** (n√£o comparar n√≠veis como se fossem categorias soltas).

---

## üéØ Objetivos de aprendizagem
- Compreender a **ANOVA para regress√£o polinomial** (linear, quadr√°tica, c√∫bica‚Ä¶).  
- Ajustar **modelos polinomiais** no contexto de **experimentos (DIC)**.  
- Avaliar **falta de ajuste (lack-of-fit)** usando o erro puro das repeti√ß√µes.  
- **Usar `ExpDes.pt`** (`dic(quali = FALSE)`) para decompor a soma de quadrados do tratamento em **componentes polinomiais**.  
- **Construir gr√°ficos com m√©dias por tratamento**, incluindo **equa√ß√£o** e **R¬≤**, no **ggplot2**.

---

## üß† Teoria ‚Äì ANOVA para regress√£o polinomial em experimento (DIC)

Considere um experimento com k **n√≠veis do fator quantitativo** (x_1, ‚Ä¶, x_k) e r repeti√ß√µes por n√≠vel. O modelo polinomial de grau g (ex.: g=2 para quadr√°tico) √©:

$$
Y_{ij} = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \cdots + \beta_g x_i^g + \varepsilon_{ij},\quad
\varepsilon_{ij} \sim \mathcal{N}(0, \sigma^2), \; i=1..k,\; j=1..r.
$$

A **ANOVA do tratamento** (tradicional) pode ser decomposta em **contrastes ortogonais**:
- **Linear (L)**, **Quadr√°tico (Q)**, **C√∫bico (C)**, ‚Ä¶, at√© grau **k-1** (limitado pela quantidade de n√≠veis).  
- Cada contraste tem seu **SQ**, **GL = 1**, **QM**, **F**, **p-valor**.  
- O **Erro (puro)** vem da **varia√ß√£o entre repeti√ß√µes** dentro de cada n√≠vel - ele permite testar **falta de ajuste** do polin√¥mio escolhido.

**Teste de falta de ajuste (LOF)**: compare um modelo ‚Äúsaturado por tratamentos‚Äù  com o **modelo polinomial** (ex.: grau 2).  
- **H0:** o polin√¥mio **ajusta bem** (sem falta de ajuste).  
- **HA:** h√° **falta de ajuste** (o polin√¥mio √© muito simples para a forma verdadeira).

---

## üì¶ Conjuntos de dados 

- **Exemplo (Dose de N ‚Üí Altura)**: [dados/dic_doseN_altura.csv](dados/dic_doseN_altura.csv)  
- **Atividade (pH ‚Üí Di√¢metro)**: [dados/dic_ph_diametro.csv](dados/dic_ph_diametro.csv)



---

## üå≥ EXEMPLO ‚Äì Dose de N √ó Altura (DIC, quantitativo)

### Descri√ß√£o do experimento
- **Fator (quantitativo):** Dose de nitrog√™nio (mg/L) ‚Äî n√≠veis: 0, 40, 80, 120, 160.  
- **Unidades experimentais:** bandejas (5 mudas), resposta = **Altura (cm)** aos 90 dias.  
- **Repeti√ß√µes:** 5 por dose (**erro puro** dispon√≠vel).  
- **Hip√≥tese biol√≥gica:** resposta **quadr√°tica** com √≥timo em torno de 110‚Äì120 mg/L.

### An√°lise com ExpDes.pt (decomposi√ß√£o polinomial)

```{r}
library(readr); library(dplyr); library(ggplot2)
library(ExpDes.pt)

# Quarto local:
dados <- read_csv("dados/dic_doseN_altura.csv", show_col_types = FALSE)
# Colab:
# dados <- read_csv("/content/dic_doseN_altura.csv", show_col_types = FALSE)

dados <- dados |>
  mutate(
    Dose_N_mgL = as.numeric(Dose_N_mgL)
  )

# ExpDes: DIC com fator quantitativo -> quali = FALSE (faz decomposi√ß√£o polinomial)
out_dic <- dic(
  trat  = dados$Dose_N_mgL,
  resp  = dados$Altura_cm,
  quali = FALSE            # graus a testar (at√© k-1); aqui 4 n√≠veis polinomiais
)

#out_dic
```



### Gr√°fico com **m√©dias por dose**, equa√ß√£o e R¬≤
```{r}
# M√©dias por tratamento
medias <- dados |>
  group_by(Dose_N_mgL) |>
  summarise(Altura_media = mean(Altura_cm), .groups = "drop")

# Ajuste polinomial nas M√âDIAS (pr√°tica experimental para figura de relat√≥rio)
fit_med <- lm(Altura_media ~ Dose_N_mgL + I(Dose_N_mgL^2), data = medias)

# Coeficientes e R2
coefs <- coef(fit_med)
b0 <- coefs[1]; b1 <- coefs[2]; b2 <- coefs[3]
R2 <- summary(fit_med)$r.squared

# Curva suave
newd <- data.frame(Dose_N_mgL = seq(min(medias$Dose_N_mgL), max(medias$Dose_N_mgL), length.out = 200))
newd$yhat <- predict(fit_med, newdata = newd)


ggplot(medias, aes(Dose_N_mgL, Altura_media)) +
  geom_point(size = 3) +
  geom_line(data = newd, aes(Dose_N_mgL, yhat)) +
  labs(title = "Altura √ó Dose de N (m√©dias por tratamento)",
       x = "Dose de N (mg/L)",
       y = "Altura m√©dia (cm)") +
  theme_minimal()
```


### üîß N√≠vel √≥timo (v√©rtice) pelo m√©todo da 1¬™ derivada

Considere o **modelo quadr√°tico** ajustado (em geral, sobre as **m√©dias por tratamento**):
$$
\hat{Y}(x) = \beta_0 + \beta_1 x + \beta_2 x^2.
$$
O ponto de √≥timo (m√°ximo ou m√≠nimo) ocorre quando a **1¬™ derivada** √© zero:
$$
\frac{d\hat{Y}}{dx} = \beta_1 + 2\beta_2 x = 0 ;\Rightarrow;
\boxed{x^* = -\frac{\beta_1}{2\beta_2}}.
$$

* **M√°ximo** (√≥timo desej√°vel): se $\beta_2 < 0 \Rightarrow$ concavidade voltada para baixo.
* **M√≠nimo**: se $\beta_2 > 0$.
* **Aten√ß√£o ao dom√≠nio**: se $x^*$ ficar **fora** do intervalo testado $(x_{\min}, x_{\max})$, **prefira** o melhor ponto **na borda** do dom√≠nio experimental.



#### Implementa√ß√£o pr√°tica (R)

Supondo que voc√™ ajustou o quadr√°tico nas **m√©dias por tratamento**:

```{r}

b <- coef(fit_med)
b0 <- b[1]; b1 <- b[2]; b2 <- b[3]

# n√≠vel √≥timo

x_star <- -b1/(2*b2)
x_star

#y_star <- b0 + b1*x_star + b2*x_star^2
#y_star
```

::: callout-tip
**F√≥rmula pr√°tica (modelo grau 2):**
$$
\boxed{x^* = -\dfrac{\beta_1}{2\beta_2},}
$$
Use somente quando houver **evid√™ncia de curvatura** (componente Quadr√°tica significativa e/ou LOF n√£o significativo) e **(\beta_2<0)** para m√°ximo.
:::




---

## üåø ATIVIDADE ‚Äì pH do substrato √ó Di√¢metro (DIC, quantitativo)

### Descri√ß√£o do experimento
- **Fator (quantitativo):** pH do substrato (4.5, 5.0, 5.5, 6.0, 6.5).  
- **Unidade experimental:** bandeja (5 mudas), resposta = **Di√¢metro (mm)** aos 90 dias.  
- **Repeti√ß√µes:** 5 por pH (**erro puro** dispon√≠vel).  
- **Hip√≥tese biol√≥gica:** resposta **quadr√°tica** com n√≠vel √≥timo presente.

üì¶ **Dados**: [dados/dic_ph_diametro.csv](dados/dic_ph_diametro.csv)

1. Rode o experimento, gere o grafico do polin√¥mio escolhido e encontre a nivel √≥timo se for possivel (caso o polin√¥mio seja de grau 2)

---

## ‚úÖ S√≠ntese
- Em **fatores quantitativos**, relatar **regress√£o** √© mais informativo do que apenas ‚Äútestes de m√©dias‚Äù.  
- A **ANOVA polinomial** decomp√µe o efeito de tratamento em **L, Q, C‚Ä¶**, e o **erro puro** das repeti√ß√µes permite testar **falta de ajuste**.  
- Gr√°ficos devem usar **m√©dias por tratamento** e o n√≠vel √≥timo deve ser encontrado.
