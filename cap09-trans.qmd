---
title: "üìñ Transforma√ß√£o de Dados"
---

*M√≥dulo 2 ‚Äì Semana 11*

## üå± Contexto aplicado

Durante a an√°lise de experimentos florestais, nem sempre os **dados atendem aos pressupostos da ANOVA**: vari√¢ncias podem diferir entre tratamentos (heterocedasticidade), os res√≠duos podem ser assim√©tricos ou n√£o normais, e h√° limites naturais da escala (propor√ß√µes/contagens) que distorcem a variabilidade. Esses problemas afetam os testes F e t, pois violam as hip√≥teses de **normalidade e homogeneidade** do erro experimental.

üí° Nesses casos, aplicamos **transforma√ß√µes matem√°ticas** na vari√°vel resposta para aproximar a normalidade e **estabilizar vari√¢ncias**, preservando a estrutura experimental e a interpreta√ß√£o do delineamento.

---

## üéØ Objetivos de aprendizagem

- Verificar **pressupostos** (normalidade e homogeneidade) com testes e gr√°ficos.  
- Escolher e aplicar **transforma√ß√µes adequadas** (arco seno da raiz, raiz quadrada, log).  
- Reanalisar com **ExpDes.pt** e interpretar **na escala original**.  
- Produzir gr√°ficos antes/depois da transforma√ß√£o para comparar distribui√ß√µes e res√≠duos.

---

## üß† Fundamenta√ß√£o te√≥rica resumida

A ANOVA assume erros $\varepsilon \sim N(0,\,\sigma^2)$ (independentes, vari√¢ncia constante e normalidade). Quando isso **n√£o se sustenta**, utilizamos transforma√ß√µes cl√°ssicas:

| Tipo de vari√°vel (ou problema) | Transforma√ß√£o sugerida | Express√£o | Observa√ß√µes |
|---|---|---|---|
| **Propor√ß√µes/percentuais (0‚Äì100%)** | Arco seno da raiz | $y' = \arcsin(\sqrt{y/100})$ | Estabiliza vari√¢ncias; interpretar na escala original: $\sin^2(y')\times 100$. |
| **Contagens (n)** | Raiz quadrada | $y' = \sqrt{y + 0.5} $ | Padr√£o Poisson-like; ‚Äú+0.5‚Äù evita raiz de zero. |
| **Assimetria positiva (pesos/tempos)** | Log | $y' = \ln(y) \) ou \( \ln(y+1)$ | Reduz assimetria; cuidado com zeros. |
| **Vari√¢ncia cresce com a m√©dia** | Inversa da raiz | $y' = 1/\sqrt{y}$ | Casos extremos; interpreta√ß√£o menos intuitiva. |
| **Percentuais muito pr√≥ximos de 0 ou 100** | Arco seno ajustado | $y' = \arcsin(\sqrt{(y+0.5)/100})$ | Suaviza extremidades (0 e 100). |

::: callout-tip
**Pr√°tica** ‚Äî Sempre cheque **res√≠duos x valores ajustados**, **histograma** e **QQ-plot**, antes e depois da transforma√ß√£o.  
Se homogeneidade e normalidade melhorarem e as conclus√µes forem coerentes, a transforma√ß√£o foi **bem-sucedida**.
:::

---

## üå≥ EXEMPLO ‚Äî Controle de doen√ßa (percentual)

**Contexto:** quatro m√©todos de controle (biol√≥gicos e qu√≠mico) aplicados ao viveiro de *Eucalyptus* para reduzir **incid√™ncia de doen√ßa (%)**. DIC com 5 repeti√ß√µes por tratamento.

üì¶ **Dados:** [dados/controle_fungico.csv](/dados/controle_fungico.csv)

### An√°lise explorat√≥ria e pressupostos
```{r}
library(readr); library(dplyr); library(ggplot2); library(ExpDes.pt)

dados <- read_csv("dados/controle_fungico.csv", show_col_types = FALSE)

# Boxplot inicial
ggplot(dados, aes(Tratamento, Incidencia)) +
  geom_boxplot(alpha=0.5) +
  labs(title="Incid√™ncia (%) por tratamento", y="Incid√™ncia (%)") +
  theme_minimal()

# ANOVA (dados na escala original)
out0 <- dic(trat = dados$Tratamento, resp = dados$Incidencia, quali = TRUE)

# Pressupostos
mod0 <- aov(Incidencia ~ Tratamento, data = dados)
shapiro.test(residuals(mod0))
bartlett.test(Incidencia ~ Tratamento, data = dados)
```

### Transforma√ß√£o **arco seno da raiz**
```{r}
dados <- dados |>
  mutate(inc_asin = asin(sqrt(Incidencia/100)))

out1 <- dic(trat = dados$Tratamento, resp = dados$inc_asin, quali = TRUE)

mod1 <- aov(inc_asin ~ Tratamento, data = dados)
shapiro.test(residuals(mod1))
bartlett.test(inc_asin ~ Tratamento, data = dados)
```

### Visualiza√ß√£o comparativa
```{r}
# Densidade dos res√≠duos (antes/depois)
res0 <- data.frame(tipo="Original", res = residuals(mod0))
res1 <- data.frame(tipo="Transformado", res = residuals(mod1))
rbind(res0,res1) |>
  ggplot(aes(res, fill=tipo)) +
  geom_density(alpha=.4) +
  labs(title="Res√≠duos: original vs transformado") +
  theme_minimal()
```

### Retradu√ß√£o das m√©dias
A m√©dia transformada $\bar{y}'$ pode ser reescrita como percentual pela regra
$\hat{p} = [\sin(\bar{y}')]^2\times 100$.

```{r}
# M√©dias por tratamento (transformadas e retraduzidas para %)
medias_inc <- dados |>
  group_by(Tratamento) |>
  summarise(med_asin = mean(inc_asin), .groups="drop") |>
  mutate(media_perc = (sin(med_asin)^2)*100)

medias_inc
```

---

## üåø ATIVIDADE ‚Äî N√∫mero de brotos (contagem)

**Contexto:** cinco bioestimulantes (B1‚ÄìB5) em mudas de **Cedrela fissilis**; resposta = **n√∫mero de brotos** por muda. DIC com 6 repeti√ß√µes.

üì¶ **Dados:** [dados/brotos_cedrela.csv](/dados/brotos_cedrela.csv)

1. Realize a an√°lise, teste os pressupostos e aplique a transforma√ß√£o adequada. Ao final apresente as m√©dias na escala original.   

::: callout-tip
Com dados de contagem (Poisson) usa-se a transfroma√ß√£o com a raiz quadrada, ent√£o para transfromar de volta usa-se $\hat{y} \approx (\bar{y}')^2 - 0.5$
:::


---

## ‚úÖ S√≠ntese

- Transforma√ß√µes **n√£o s√£o truque**, mas um **ajuste de escala** para cumprir pressupostos.  
- Escolha baseada no **tipo de vari√°vel** e no **padr√£o de heterogeneidade**.  
- Reavalie sempre **normalidade** e **homogeneidade** ap√≥s transformar.  
- Relate as conclus√µes **na escala original** (com a regra de retradu√ß√£o correspondente).

