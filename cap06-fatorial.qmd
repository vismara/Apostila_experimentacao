---
title: "ğŸ“– Delineamentos Fatoriais (2x2)"
---

*MÃ³dulo 2 â€“ Semana 8*

## ğŸŒ± Narrativa aplicada

Um viveiro florestal deseja otimizar o **crescimento inicial** de mudas nativas combinando **tipo de substrato** e **regime de irrigaÃ§Ã£o**.  
HÃ¡ indÃ­cios de que um substrato responde **muito melhor quando a irrigaÃ§Ã£o Ã© alta**, mas o comportamento **pode se inverter** em dÃ©ficit hÃ­drico.  
Para responder, vamos **testar os dois fatores simultaneamente** com um **delineamento fatorial 2Ã—2**.

- **Fator 1 â€“ Substrato**: **A** (comercial estÃ¡vel) vs **B** (formulaÃ§Ã£o que potencialmente responde mais Ã  Ã¡gua).  
- **Fator 2 â€“ IrrigaÃ§Ã£o**: **Baixa** vs **Alta**.  
- **Unidade experimental**: muda em tubete (55 cmÂ³).  
- **RepetiÃ§Ãµes**: 10 por combinaÃ§Ã£o (total = 40).  
- **VariÃ¡vel resposta**: **Altura (cm)** aos **90 dias** pÃ³s-semeadura.

::: callout-tip
ğŸ’¡ **Por que fatorial?** Compara **efeitos principais** e testa **interaÃ§Ã£o**. Se houver interaÃ§Ã£o, **o melhor substrato depende da irrigaÃ§Ã£o** (e viceâ€‘versa) â€” informaÃ§Ã£o crucial para o manejo.
:::

## ğŸ¯ Objetivos de aprendizagem
- Entender **efeitos principais** e **interaÃ§Ã£o** em fatoriais.  
- Especificar e ajustar o **modelo linear** com interaÃ§Ã£o.  
- Visualizar e interpretar **grÃ¡ficos de interaÃ§Ã£o**.  
- Traduzir **efeitos estatÃ­sticos em decisÃµes operacionais** (impacto de irrigaÃ§Ã£o).

## ğŸ§® Modelo linear (fatorial 2Ã—2)

$$
Y_{ijk} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \varepsilon_{ijk},\quad
\varepsilon_{ijk} \sim \mathcal{N}(0, \sigma^2)
$$

- $\alpha_i$: efeito do **substrato** (i = A,B)  
- $\beta_j$: efeito da **irrigaÃ§Ã£o** (j = Baixa,Alta)  
- $(\alpha\beta)_{ij}$: **interaÃ§Ã£o** (o efeito de um fator **depende** do nÃ­vel do outro)

## ğŸ“¦ Dados desta anÃ¡lise
- [dados/fatorial_substrato_irrigacao_2x2.csv](dados/fatorial_substrato_irrigacao_2x2.csv)  
  - Colab: `/content/fatorial_substrato_irrigacao_2x2.csv`  
  - Quarto local: `dados/fatorial_substrato_irrigacao_2x2.csv`

## ğŸ’» AnÃ¡lise no R

```{r}
library(readr); library(dplyr); library(ggplot2)

# Quarto local:
dados <- read_csv("dados/fatorial_substrato_irrigacao_2x2.csv", show_col_types = FALSE)
# Colab:
# dados <- read_csv("/content/fatorial_substrato_irrigacao_2x2.csv", show_col_types = FALSE)

# Fatores com ordem explÃ­cita (Ãºtil para grÃ¡ficos e relatÃ³rios)
dados$Substrato <- factor(dados$Substrato, levels = c("A","B"))
dados$Irrigacao <- factor(dados$Irrigacao, levels = c("Baixa","Alta"))

# ANOVA fatorial com interaÃ§Ã£o (modelo completo)
mod_full <- aov(Altura_cm ~ Substrato * Irrigacao, data = dados)
summary(mod_full)
```

### ğŸ” Modelo com interaÃ§Ã£o vs. modelo aditivo (sem interaÃ§Ã£o)

Quando testamos `Substrato * Irrigacao`, estamos ajustando o **modelo com interaÃ§Ã£o**:

- **Com interaÃ§Ã£o**: $Y = \mu + \alpha + \beta + \alpha\beta + \varepsilon$  
  â€” Permite que o **efeito do substrato dependa** do nÃ­vel de irrigaÃ§Ã£o (e vice-versa).  
- **Sem interaÃ§Ã£o (aditivo)**: $Y = \mu + \alpha + \beta + \varepsilon$  
  â€” Assume efeitos **constantes** (linhas paralelas no grÃ¡fico de interaÃ§Ã£o).

**Por que ajustar o modelo sem interaÃ§Ã£o?**  
- Como **modelo de referÃªncia**: se a interaÃ§Ã£o **nÃ£o for significativa**, o modelo aditivo Ã© **mais simples** e direto para comunicar.  
- Para **comparar ajuste**: em casos limÃ­trofes, compare `mod_full` vs. `mod_add` para checar se a complexidade extra se justifica.

```{r}
# Modelo sem interaÃ§Ã£o (aditivo)
mod_add  <- aov(Altura_cm ~ Substrato + Irrigacao, data = dados)

# ComparaÃ§Ã£o formal
anova(mod_add, mod_full)   # p < 0,05 â†’ manter interaÃ§Ã£o
AIC(mod_add, mod_full)     # critÃ©rio de informaÃ§Ã£o (menor Ã© preferÃ­vel)
```

::: callout-note
ğŸ“Œ **Regra prÃ¡tica**  
- **InteraÃ§Ã£o significativa** â†’ comunique **recomendaÃ§Ãµes condicionais** (â€œCom **IrrigaÃ§Ã£o Alta**, prefira **B**; com **Baixa**, **A**â€).  
- **InteraÃ§Ã£o nÃ£o significativa** â†’ use o **modelo aditivo** e reporte **efeitos principais**.
:::

## ğŸ“ˆ GrÃ¡ficos de apoio

```{r}
# Boxplot por combinaÃ§Ã£o
ggplot(dados, aes(x = Substrato, y = Altura_cm, fill = Irrigacao)) +
  geom_boxplot(position = position_dodge(width = .8)) +
  labs(title = "Altura por Substrato Ã— IrrigaÃ§Ã£o (90 dias)",
       x = "Substrato", y = "Altura (cm)", fill = "IrrigaÃ§Ã£o") +
  theme_minimal()

# GrÃ¡fico de interaÃ§Ã£o (mÃ©dias por cÃ©lula)
medias <- dados %>% group_by(Substrato, Irrigacao) %>% summarise(media = mean(Altura_cm), .groups = "drop")
ggplot(medias, aes(Irrigacao, media, group = Substrato, shape = Substrato)) +
  geom_point(size = 3) + geom_line() +
  labs(title = "GrÃ¡fico de interaÃ§Ã£o (mÃ©dias)",
       x = "IrrigaÃ§Ã£o", y = "Altura mÃ©dia (cm)")
```

### ğŸ§­ â€œImpacto operacionalâ€ da irrigaÃ§Ã£o (o que significa?)

â€œImpacto operacionalâ€ traduz a estatÃ­stica para **decisÃ£o de viveiro**. Exemplos prÃ¡ticos:

- **Custo de Ã¡gua/energia**: irrigaÃ§Ã£o **Alta** pode elevar custos; sÃ³ vale a pena se o ganho de crescimento (ex.: +3 cm aos 90 dias) **compensar**.  
- **Capacidade de infraestrutura**: regimes altos podem exigir **bombas**/turnos adicionais; Ã s vezes **A Ã— Baixa** Ã© preferÃ­vel por **simplicidade**.  
- **Risco de manejo**: irrigaÃ§Ã£o alta pode elevar risco de **fungos**; se o ganho for pequeno, **nÃ£o compensa**.  
- **Meta de produÃ§Ã£o**: se a meta Ã© atingir **altura mÃ­nima** para expediÃ§Ã£o em 90 dias, escolher a combinaÃ§Ã£o que **garanta a meta** com **menor variÃ¢ncia**.

::: callout-tip
âœ… **Como escrever no relatÃ³rio**  
â€œCom irrigaÃ§Ã£o **Alta**, o Substrato **B** apresentou ganho mÃ©dio de **+3,2 cm** (IC 95%: +2,4 a +4,0) em relaÃ§Ã£o a **A**. Considerando o custo adicional de Ã¡gua e maior risco de doenÃ§a, recomendamos **B Ã— Alta** **apenas** quando a meta de expediÃ§Ã£o exigir esse ganho.â€
:::

## ğŸ“ Por que **intervalos de confianÃ§a** (IC)?

O valor-p diz **se** hÃ¡ evidÃªncia de diferenÃ§a; o **IC** diz **quanto** e com **que precisÃ£o**. Em decisÃµes de manejo, o â€œquantoâ€ Ã© crucial (ganho esperado).

```{r}
# Com emmeans: estimativas marginais e ICs
# install.packages("emmeans") # se necessÃ¡rio
library(emmeans)

# ICs para as 4 cÃ©lulas (mÃ©dias ajustadas)
emm_cells <- emmeans(mod_full, ~ Substrato * Irrigacao)
summary(emm_cells, infer = c(TRUE, TRUE))  # inclui ICs

# GrÃ¡fico com ICs
plot(emm_cells) + ggtitle("MÃ©dias ajustadas com IC (Substrato Ã— IrrigaÃ§Ã£o)")
```

::: callout-important
âš ï¸ **DecisÃ£o baseada em efeito**  
Mesmo com p < 0,05, um ganho com IC estreito e **pequena magnitude** pode **nÃ£o justificar** alterar o manejo. ICs deixam isso **explÃ­cito**.
:::

## ğŸ”¬ Efeitos simples (quando hÃ¡ interaÃ§Ã£o)

```{r}
# Comparar Substrato dentro de cada regime de IrrigaÃ§Ã£o
dados %>% filter(Irrigacao == "Baixa") %>% aov(Altura_cm ~ Substrato, data = .) %>% summary()
dados %>% filter(Irrigacao == "Alta")  %>% aov(Altura_cm ~ Substrato, data = .) %>% summary()
```

*(Opcional avanÃ§ado)* com **emmeans**:
```{r}
emm_sub_by_irr <- emmeans(mod_full, ~ Substrato | Irrigacao)
pairs(emm_sub_by_irr)        # compara Substrato dentro de cada IrrigaÃ§Ã£o
```

## ğŸ§¾ â€œColaâ€ para o relatÃ³rio
1) Descreva **o problema de manejo** (otimizar crescimento via Substrato Ã— IrrigaÃ§Ã£o).  
2) Relate a **ANOVA fatorial** (F, p) para fatores e interaÃ§Ã£o.  
3) Se houver interaÃ§Ã£o, apresente **efeitos simples** e **grÃ¡fico de interaÃ§Ã£o**.  
4) FaÃ§a uma **recomendaÃ§Ã£o condicional**, citando **ICs** para justificar a decisÃ£o.

## ğŸ“ ExercÃ­cios 
1. **InteraÃ§Ã£o e recomendaÃ§Ã£o condicional**: ajuste `mod_full` e `mod_add`, compare com `anova(mod_add, mod_full)`. Se houver interaÃ§Ã£o, faÃ§a **efeitos simples** e escreva **2â€“3 frases** com a recomendaÃ§Ã£o condicional.  
2. **MÃ©dias ajustadas e ICs (quantificar o ganho)**: use `emmeans` para obter **mÃ©dias + IC 95%** por cÃ©lula; faÃ§a um grÃ¡fico e responda: **qual combinaÃ§Ã£o** tem maior ganho? A **margem de incerteza** justifica mudar o manejo?  
3. **CenÃ¡rio operacional**: suponha custo extra de irrigaÃ§Ã£o **Alta** de **R$ 0,05/muda/dia**. Em 90 dias e 10.000 mudas, o custo adicional Ã© **R$ 45.000**. Com base nos **ICs**, quando vale a pena **B Ã— Alta**?  
4. **Relato final**: entregue um parÃ¡grafo que combine **estatÃ­stica + operaÃ§Ã£o** (p-valores, ICs, recomendaÃ§Ã£o clara).

## âœ… SÃ­ntese
- O fatorial 2Ã—2 permite testar **efeitos principais** e **interaÃ§Ã£o**.  
- **Modelo com interaÃ§Ã£o** vs. **modelo aditivo** ajuda a decidir **como comunicar** resultados.  
- **ICs** quantificam **ganhos** e **incertezas**, fundamentais para **decisÃ£o de manejo**.
